dist: xenial

language: go

go:
  - 1.12.x

env:
  - GO111MODULE=on

go_import_path: github.com/appsody/appsody-operator

services:
  - docker

cache:
  directories:
    - vendor 

stages:
  - name: build
  - name: unit test
  - name: e2e test
  - name: push

jobs:
 include:
  - name: unit test
    stage: unit test
    script:
    - make unit-test
  - name: e2e test
    stage: e2e test
    script: 
    - make setup-cluster
  - name: push docker image
    stage: build and push
    script:
    - make build-image
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - make push-image
